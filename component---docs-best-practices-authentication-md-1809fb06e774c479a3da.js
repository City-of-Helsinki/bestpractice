(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{BtpT:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return l})),n.d(t,"default",(function(){return r}));n("5hJT"),n("W1QL"),n("K/PF"),n("t91x"),n("75LO"),n("PJhk");var o=n("SAVP"),a=n("TjRS");n("aD51");function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var l={};void 0!==l&&l&&l===Object(l)&&Object.isExtensible(l)&&!l.hasOwnProperty("__filemeta")&&Object.defineProperty(l,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"docs/best-practices/authentication.md"}});var s={_frontmatter:l},u=a.a;function r(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,["components"]);return Object(o.b)(u,i({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"authentication"},"Authentication"),Object(o.b)("p",null,"Most of the projects requiring any sort of user authentication should use Tunnistamo.\nTunnistamo is a service that authenticates users against several different identity sources,\nincluding Espoo, Vantaa and Helsinki internal accounts, Facebook, Google and Github.\nTunnistamo also keeps a running session for the user, meaning the user won't be needing\nto login again to access another service using tunnistamo."),Object(o.b)("p",null,"The actual line protocols are OAuth2 and OIDC. New applications should always use OIDC."),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"Nomenclature alert"),': Tunnistamo will soon be changing names, as the implementation will switch from your own implementation (named "tunnistamo") to Keycloak based implementation. Keeping the same name would be too confusing. We\'re not sure of the upcoming name yet.'),Object(o.b)("h2",{id:"getting-necessary-tunnistamo-identifiers"},"Getting necessary Tunnistamo identifiers"),Object(o.b)("p",null,"To get started you will either need a locally setup instance of Tunnistamo or get access to one of shared instances available within Helsinki infrastructure. It is recommended that you try and get access to the shared instances, unless you must develop offline. "),Object(o.b)("p",null,"Current instances are:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Kanslia (executive office) instance: default instance used by projects, both during development and production"),Object(o.b)("li",{parentName:"ul"},"KuVa (culture and leisure) instance: instance used by KuVa projects during their development. Very flexible registration")),Object(o.b)("p",null,"To get access to Kanslia instance, pop by the slack channel #tunnistamo.\nFor KuVa instance the onboarding process has already told you the right channels."),Object(o.b)("p",null,"Things can be faster if you can include in your initial message:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"responsible person for your application"),Object(o.b)("li",{parentName:"ul"},'your OpenID Connect flow type. Currently we can only support "Authorization Code" and "Implicit" flow types.'),Object(o.b)("li",{parentName:"ul"},"your callback url")),Object(o.b)("p",null,'Flow type depends on your application. Typically, if your application has some sort of backend running server-side, you will be using Authorization Code flow. Conversely, if your application exists only as Javascript files served to the client browser ("SPA"), you will be using Implicit flow. Implicit flow has some security weaknesses, and is being replaced by "Authorization code flow with PKCE". We unfortunately cannot support it yet.'),Object(o.b)("p",null,"Callback URL is the address within your application for finalizing the authentication. You will have at least two callbacks:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},'one within "localhost", for using on your local development box'),Object(o.b)("li",{parentName:"ul"},"one or more, that refer to public instances of your application")),Object(o.b)("p",null,"As a concrete result you will have three pieces of data:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"the URL for your tunnistamo instance (like ",Object(o.b)("a",i({parentName:"li"},{href:"https://api.hel.fi/sso/"}),"https://api.hel.fi/sso/"),", the executive office instance)"),Object(o.b)("li",{parentName:"ul"},"your client ID"),Object(o.b)("li",{parentName:"ul"},"your client secret (only for Authorization Code flow)")),Object(o.b)("p",null,"Armed with those, and knowledge of your callback URL, you can begin attaching authentication to your application."),Object(o.b)("h2",{id:"handling-authentication-user-login"},"Handling authentication (user login)"),Object(o.b)("p",null,"Actual usage is abstracted behind libraries:"),Object(o.b)("p",null,"Django based backends: ",Object(o.b)("a",i({parentName:"p"},{href:"https://github.com/City-of-Helsinki/django-helusers"}),"django-helusers")),Object(o.b)("p",null,"JS based frontends: no specific library at the moment, would be beneficial"),Object(o.b)("p",null,"For django-helusers, the README should get you up and running. For JS frontends you will currently have to ask around, Google and look into other JS projects within github.com/City-of-Helsinki"),Object(o.b)("h2",{id:"logout"},"Logout"),Object(o.b)("p",null,"Logout on SSO systems is always kind of tricky. Do you want to only close the session in\nyour application and purge any ephemeral state? In that case user will be automatically\nlogged back in through their tunnistamo session, should they press login again."),Object(o.b)("p",null,"The more thorough logout is to call tunnistamo logout. This has been woefully\nundocumented. Currently suggested procedure is:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Destroy any local state (tokens usw.)"),Object(o.b)("li",{parentName:"ol"},"Open a popup to the OIDC end_session_endpoint available through OIDC discovery document\n(",Object(o.b)("a",i({parentName:"li"},{href:"https://api.hel.fi/sso/.well-known/openid-configuration"}),"https://api.hel.fi/sso/.well-known/openid-configuration")," ). You can use this regardless\nof whether your application uses OAuth2 or OIDC."),Object(o.b)("li",{parentName:"ol"},"SSO will include a code in the popup that will close it automatically")),Object(o.b)("p",null,"The authentication libraries you use might handle all these steps automatically."),Object(o.b)("p",null,"The logout popup will inform the user that they will need to log out of any upstream IdPs\n(like YLE or Facebook), if they are on shared computer."),Object(o.b)("p",null,"SPA can additionally listen for postMessage hel:logout. This is supposed to indicate that\nthe logout actually succeeded. (This is not actually implemented at the moment)."))}r&&r===Object(r)&&Object.isExtensible(r)&&!r.hasOwnProperty("__filemeta")&&Object.defineProperty(r,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"docs/best-practices/authentication.md"}}),r.isMDXComponent=!0}}]);
//# sourceMappingURL=component---docs-best-practices-authentication-md-1809fb06e774c479a3da.js.map